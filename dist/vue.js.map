{"version":3,"file":"vue.js","sources":["../src/observer/array.js","../src/observer/index.js","../src/core/state.js","../src/core/init.js","../src/index.js"],"sourcesContent":["let oldArrayMethods = Array.prototype;\n\nexport const newArrayMethods = Object.create(oldArrayMethods);\n// 会改变原数组的方法\nlet methods = [\"push\", \"pop\", \"shift\", \"unshift\", \"reverse\", \"sort\", \"splice\"];\n\n// 切面编程\nmethods.forEach((method) => {\n\tnewArrayMethods[method] = function (...args) {\n        // this 就是 value\n        console.log('数组方法被调用了，这里是拦截信息的方法');\n        const res = oldArrayMethods[method].apply(this, args);\n        let ob = this.__ob__;\n        let inserted;\n        switch (method) {\n            case 'push':\n            case 'unshift':\n                inserted = args; // 数组追加方法 内容如果是对象继续劫持\n                break;\n            case 'splice':\n                inserted = args.slice(2); // arr.splice(0,1,{a:2}) 劫持第三个参数\n                break;\n            default:\n                break;\n        }\n        if(inserted){\n            ob.observeArray(inserted);\n        }\n        return res;\n\t};\n});\n","import { newArrayMethods } from \"./array\";\n/**\n *  new Vue({\n *      data(){\n *          return {} 对这个对象进行观测\n *      }\n *  })\n */\nclass Observer {\n\tconstructor(value) {\n\t\t// console.log(\"02 Observer obj\", value);\n\t\t// 骚操作: 为了让数组新方法里面拥有observeArray，给实例定义私有属性，挂到实例上，并且指向自己, __ob__就是当前实例\n\t\tObject.defineProperty(value,'__ob__',{\n\t\t\tenumerable:false, // 不可枚举\n\t\t\tconfigurable:false,\n\t\t\tvalue: this\n\t\t});\n\t\tif (Array.isArray(value)) {\n\t\t\t// 对数组方法进行劫持 不对数组索引进行劫持\n\t\t\t// 劫持到数组方法操作之后 加自己的逻辑 AOP切面编程\n\t\t\t// push pop shift unshift sort reverse splice slice\n\t\t\t// 将数组的原型链先指向新方法的原型对象，最后还是会指向数组的原型对象\n\t\t\t// [1,2,3].__proto__  = newArrayMethods.prototype\n\t\t\tvalue.__proto__ = newArrayMethods;  // Object.setPrototypeOf(value, newArrayMethods); // 等价\n\t\t\tthis.observeArray(value);\n\t\t} else {\n\t\t\tthis.walk(value);\n\t\t}\n\t}\n\twalk(obj) {\n\t\t// case1: 对单纯的对象加上 get/set  {a:1}\n\t\t// case2: 对多层对象加上 get/set\n\t\tlet keys = Object.keys(obj);\n\t\tkeys.forEach((key) => {\n\t\t\tdefineReactive(obj, key, obj[key]);\n\t\t});\n\t}\n\tobserveArray(array){\n\t\tarray.forEach(item=>{\n\t\t\tobserve(item);\n\t\t})\n\t}\n}\nfunction defineReactive(obj, key, value) {\n\t// 如果value仍然是object类型，继续递归加get/set\n\tobserve(value);\n\tObject.defineProperty(obj, key, {\n\t\tenumerable: true,\n\t\tconfigurable: true,\n\t\tget() {\n\t\t\tconsole.log(\"你在取值操作\", key);\n\t\t\t// console.dir({ atype: \"get 获取值\", key });\n\t\t\treturn value;\n\t\t},\n\t\tset(newValue) {\n\t\t\tconsole.log(\"你在设置值操作\", key, value, newValue);\n\t\t\t// console.dir({ atype: \"set 设置值\", value, newValue });\n\t\t\tif (value === newValue) return;\n\t\t\tobserve(newValue); // 用户将值改为对象类型，对新赋值的对象再进行递归观测\n\t\t\tvalue = newValue; // 不允许使用 obj[key] = value 赋值，造成死循环\n\t\t},\n\t});\n}\n\n// data 必须是个对象才Object.defineProperty\nexport function observe(data) {\n\t// 只对对象进行观测 基本类型和null不观测\n\tif (typeof data !== \"object\" && data !== null) {\n\t\treturn;\n\t}\n\tif(data.__ob__){\n\t\treturn data;\n\t}\n\treturn new Observer(data);\n}\n","import { observe } from \"../observer/index.js\";\n\n// 初始化状态 vue中很多状态 data props methods watch computed\nexport function initState(vm) {\n\tconsole.log(\"01 init state\", vm);\n    const { props, methods, data, computed, watch } = vm.$options;\n    // 初始化data\n\tif (data) {\n\t\tinitData(vm);\n    }\n    // 初始化props\n\tif (props) {\n\t\tinitProps(vm);\n    }\n    // 初始化methods\n\tif (methods) {\n\t\tinitMethods(vm);\n    }\n    // 初始化computed\n\tif (computed) {\n\t\tinitComputed(vm);\n    }\n    // 初始化watch\n\tif (watch) {\n\t\tinitWatch(vm);\n\t}\n}\n\n/** 数据响应式原理\n *  new Vue({\n *    data(){\n *      return {}\n *    }\n *\n *    data: {}\n * })\n */\nfunction initData(vm) {\n\tlet data = vm.$options.data;\n    // case1 data是方法直接调用 data.call(vm)就是执行data(){}这个方法获得结果对象\n    // case2 否则直接用对象\n    // 骚操作: 在实例vm上挂一个_data就可以拿到data(){}的返回值\n\tdata = vm._data = typeof data === \"function\" ? data.call(vm) : data; \n    \n   /**\n    * 数据劫持方案 利用Object.defineProperty\n    * 数组 单独处理\n    */\n\tobserve(data);\n}\nfunction initProps(vm) {}\nfunction initMethods(vm) {}\nfunction initComputed(vm) {}\nfunction initWatch(vm) {}\n","import { initState } from \"./state\";\n\n// 将当前实例传入 进行方法扩展 插件写法\nexport function initMixin(Vue){\n    Vue.prototype._init = function(options){\n        const vm = this; // vm=new Vue() \n        vm.$options = options; // 可以在vm上直接拿到用户new Vue(options) 里的options对象\n        \n        // 初始化状态\n        initState(vm);\n    }\n}","import { initMixin } from './core/init';\nfunction Vue(options) {\n    this._init(options); // new Vue({}) 将new里的配置直接传入_init\n}\n// 在Vue添加原型方法 _init\ninitMixin(Vue);\n\nexport default Vue"],"names":["oldArrayMethods","Array","prototype","newArrayMethods","Object","create","methods","forEach","method","args","console","log","res","apply","ob","__ob__","inserted","slice","observeArray","Observer","constructor","value","defineProperty","enumerable","configurable","isArray","__proto__","walk","obj","keys","key","defineReactive","array","item","observe","get","set","newValue","data","initState","vm","props","computed","watch","$options","initData","_data","call","initMixin","Vue","_init","options"],"mappings":"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"}